<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Consulta de Pedidos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    h2 {
      color: #333;
    }
    select, input, button {
      padding: 8px;
      margin: 10px 5px;
    }
    .resultado {
      margin-top: 20px;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .opinion {
      margin-top: 10px;
      padding: 10px;
      background: #e7f3ff;
      border-left: 4px solid #0077cc;
    }
  </style>
</head>
<body>

  <h2>Consultar Pedido</h2>

  <label>Tipo de pedido:</label>
  <select id="tipoPedido">
    <option value="cliente">Cliente</option>
    <option value="proveedor">Proveedor</option>
  </select>

  <label>ID del pedido:</label>
  <input type="number" id="pedidoId" min="1" placeholder="Ej. 1">

  <button onclick="buscarPedido()">Buscar</button>

  <div class="resultado" id="resultado"></div>

  <script>
    async function buscarPedido() {
      const id = document.getElementById('pedidoId').value;
      const tipo = document.getElementById('tipoPedido').value;
      const resultado = document.getElementById('resultado');
      resultado.innerHTML = 'üîç Buscando...';

      try {
        const res = await fetch(`http://localhost:3000/pedido/${tipo}/${id}`);
        const data = await res.json();

        if (!data || !data.pedido) {
          resultado.innerHTML = `<p>‚ùå No se encontr√≥ el pedido con ID ${id} (${tipo}).</p>`;
          return;
        }

        let html = `<h3>üì¶ Pedido ${tipo === 'cliente' ? 'de Cliente' : 'al Proveedor'} #${id}</h3>`;
        const p = data.pedido;

        if (tipo === 'cliente') {
          html += `
            <p><strong>Fecha:</strong> ${p.fecha}</p>
            <p><strong>Estado:</strong> ${p.estado}</p>
            <p><strong>Cliente:</strong> ${p.cliente_nombre} (${p.cliente_email})</p>
            <p><strong>Empleado (Vendedor):</strong> ${p.empleado_nombre}</p>
            <h4>üõí Detalles:</h4>
            <ul>
              ${p.detalles.map(d =>
                `<li>${d.producto_nombre} - Cantidad: ${d.cantidad} x S/.${d.precio_unitario.toFixed(2)}</li>`
              ).join('')}
            </ul>
          `;

          if (data.opinion) {
            const o = data.opinion;
            html += `
              <div class="opinion">
                <strong>üó£ Opini√≥n:</strong> "${o.comentario}"<br>
                ‚≠ê Calificaci√≥n: ${o.calificacion}/5 | üòä Satisfacci√≥n: ${o.satisfaccion}/5
              </div>
            `;
          }

        } else {
          html += `
            <p><strong>Fecha:</strong> ${p.fecha}</p>
            <p><strong>Estado:</strong> ${p.estado}</p>
            <p><strong>Proveedor:</strong> ${p.proveedor_nombre} (${p.proveedor_email})</p>
            <p><strong>Empleado (Administrador):</strong> ${p.empleado_nombre}</p>
            <p><strong>Observaciones:</strong> ${p.observaciones || 'Ninguna'}</p>
            <h4>üì¶ Detalles del Pedido:</h4>
            <ul>
              ${p.detalles.map(d =>
                `<li>${d.producto_nombre} - Cantidad: ${d.cantidad} x S/.${d.coste_unitario.toFixed(2)}</li>`
              ).join('')}
            </ul>
          `;
        }

        resultado.innerHTML = html;

      } catch (err) {
        resultado.innerHTML = `<p style="color:red">‚ùå Error al conectar con la API</p>`;
        console.error(err);
      }
    }
  </script>

</body>
</html>

